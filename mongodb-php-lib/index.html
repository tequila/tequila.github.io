
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="shortcut icon" href="../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.6.0">
    
    
      
        <title>MongoDB PHP Lib - Tequila Project</title>
      
    
    
      <script src="../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-72266791c5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-f78e5cb881.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="red" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href=".." title="Tequila Project" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
            
            MongoDB PHP Lib
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    Tequila Project
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        MongoDB PHP Lib
      </label>
    
    <a href="./" title="MongoDB PHP Lib" class="md-nav__link md-nav__link--active">
      MongoDB PHP Lib
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" title="Installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" title="Usage" class="md-nav__link">
    Usage
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#crud" title="CRUD" class="md-nav__link">
    CRUD
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insert-one-document" title="Insert one document" class="md-nav__link">
    Insert one document
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert-many-documents" title="Insert many documents" class="md-nav__link">
    Insert many documents
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-one-document" title="Update one document" class="md-nav__link">
    Update one document
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replace-one-document" title="Replace one document" class="md-nav__link">
    Replace one document
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-many-documents" title="Update many documents" class="md-nav__link">
    Update many documents
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-one-document" title="Delete one document" class="md-nav__link">
    Delete one document
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-many-documents" title="Delete many documents" class="md-nav__link">
    Delete many documents
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bulk-writes" title="Bulk writes" class="md-nav__link">
    Bulk writes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write-results" title="Write results" class="md-nav__link">
    Write results
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#id-of-inserted-document" title="Id of inserted document" class="md-nav__link">
    Id of inserted document
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" title="Installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" title="Usage" class="md-nav__link">
    Usage
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#crud" title="CRUD" class="md-nav__link">
    CRUD
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insert-one-document" title="Insert one document" class="md-nav__link">
    Insert one document
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert-many-documents" title="Insert many documents" class="md-nav__link">
    Insert many documents
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-one-document" title="Update one document" class="md-nav__link">
    Update one document
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replace-one-document" title="Replace one document" class="md-nav__link">
    Replace one document
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-many-documents" title="Update many documents" class="md-nav__link">
    Update many documents
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-one-document" title="Delete one document" class="md-nav__link">
    Delete one document
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-many-documents" title="Delete many documents" class="md-nav__link">
    Delete many documents
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bulk-writes" title="Bulk writes" class="md-nav__link">
    Bulk writes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write-results" title="Write results" class="md-nav__link">
    Write results
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#id-of-inserted-document" title="Id of inserted document" class="md-nav__link">
    Id of inserted document
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="getting-started">Getting started<a class="headerlink" href="#getting-started" title="Permanent link">&para;</a></h1>
<p>This high-level MongoDB driver was created to replace
<a href="https://github.com/mongodb/mongo-php-driver-legacy">Legacy MongoDB PHP Driver</a>,
i.e. <code>pecl/mongo</code> PHP extension, which for now is deprecated and does not work with PHP 7.
This library is based on the new official low-level <a href="https://github.com/mongodb/mongo-php-driver">MongoDB PHP Driver</a>,
follows <a href="https://github.com/mongodb/specifications">MongoDB Driver Specifications</a>
and defines abstractions like <code>Client</code>, <code>Database</code>, <code>Collection</code> etc.</p>
<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h2>
<p>Since this library is based on a new low-level driver, it requires this driver to be installed:</p>
<div class="codehilite"><pre><span></span>sudo pecl install mongodb
</pre></div>


<p>The library itself should be installed by Composer:</p>
<div class="codehilite"><pre><span></span>composer require tequila/mongodb-php-lib
</pre></div>


<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<p>All new drivers for MongoDB should follow <a href="https://github.com/mongodb/specifications">MongoDB Driver Specifications</a>.
By following this specifications, this library introduces different changes beside the API
of the legacy driver.
Below there are examples of how to do common tasks using this driver in comparison with the API of the legacy driver:</p>
<h3 id="crud">CRUD<a class="headerlink" href="#crud" title="Permanent link">&para;</a></h3>
<h4 id="insert-one-document">Insert one document<a class="headerlink" href="#insert-one-document" title="Permanent link">&para;</a></h4>
<p>Using this driver:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Tequila\MongoDB\Client</span><span class="p">(</span><span class="s1">&#39;mongodb://127.0.0.1/&#39;</span><span class="p">);</span>
<span class="nv">$collection</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">selectCollection</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">);</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">insertOne</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">]);</span>
</pre></div>


<p>Using the legacy driver:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\MongoClient</span><span class="p">(</span><span class="s1">&#39;mongodb://127.0.0.1/&#39;</span><span class="p">);</span>
<span class="nv">$collection</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">selectCollection</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">);</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">]);</span>
</pre></div>


<h4 id="insert-many-documents">Insert many documents<a class="headerlink" href="#insert-many-documents" title="Permanent link">&para;</a></h4>
<p>Using this driver:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="sd">/** @var \Tequila\MongoDB\Collection $collection */</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">insertMany</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;bar&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;baz&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;baz&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo&#39;</span><span class="p">],</span>
<span class="p">]);</span>
</pre></div>


<p>Using the legacy driver:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="sd">/** @var \MongoCollection $collection */</span>
<span class="nv">$batch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\MongoInsertBatch</span><span class="p">(</span><span class="nv">$collection</span><span class="p">);</span>
<span class="nv">$batch</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">]);</span>
<span class="nv">$batch</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">([</span><span class="s1">&#39;bar&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;baz&#39;</span><span class="p">]);</span>
<span class="nv">$batch</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">([</span><span class="s1">&#39;baz&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo&#39;</span><span class="p">]);</span>

<span class="nv">$batch</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>


<h4 id="update-one-document">Update one document<a class="headerlink" href="#update-one-document" title="Permanent link">&para;</a></h4>
<p>Using this driver:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">MongoDB\BSON\UTCDateTime</span><span class="p">;</span>

<span class="sd">/** @var \Tequila\MongoDB\Collection $collection */</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">updateOne</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;$set&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;updated_at&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">UTCDateTime</span><span class="p">()]]);</span>
</pre></div>


<p>Using the legacy driver:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="sd">/** @var \MongoCollection $collection */</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;$set&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;updated_at&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">\MongoDate</span><span class="p">()]],</span>
    <span class="p">[</span><span class="s1">&#39;multiple&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>


<h4 id="replace-one-document">Replace one document<a class="headerlink" href="#replace-one-document" title="Permanent link">&para;</a></h4>
<p>Using this driver:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="c1">// Collection::replaceOne() will trow an exception if a second argument contains</span>
<span class="c1">// update operators like $inc, $set etc.</span>
<span class="c1">// Collection::updateOne() will throw an exception if a second argument is a replacement document.</span>

<span class="sd">/** @var \Tequila\MongoDB\Collection $collection */</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">replaceOne</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;bar&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;baz&#39;</span><span class="p">]);</span>
</pre></div>


<p>Using the legacy driver:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="sd">/** @var \MongoCollection $collection */</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;bar&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;baz&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;multiple&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>


<h4 id="update-many-documents">Update many documents<a class="headerlink" href="#update-many-documents" title="Permanent link">&para;</a></h4>
<p>Using this driver:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="sd">/** @var \Tequila\MongoDB\Collection $collection */</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">updateMany</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;$exists&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;$set&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;isTestDocument&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]]</span>
<span class="p">);</span>
</pre></div>


<p>Using the legacy driver:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="sd">/** @var \MongoCollection $collection */</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;$exists&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;$set&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;isTestDocument&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;multiple&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>


<h4 id="delete-one-document">Delete one document<a class="headerlink" href="#delete-one-document" title="Permanent link">&para;</a></h4>
<p>Using this driver:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="sd">/** @var \Tequila\MongoDB\Collection $collection */</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">deleteOne</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">]);</span>
</pre></div>


<p>Using the legacy driver:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="sd">/** @var \MongoCollection $collection */</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;justOne&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]);</span>
</pre></div>


<h4 id="delete-many-documents">Delete many documents<a class="headerlink" href="#delete-many-documents" title="Permanent link">&para;</a></h4>
<p>Using this driver:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="sd">/** @var \Tequila\MongoDB\Collection $collection */</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">deleteMany</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">]);</span>
</pre></div>


<p>Using the legacy driver:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="sd">/** @var \MongoCollection $collection */</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;justOne&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">]);</span>
</pre></div>


<h4 id="bulk-writes">Bulk writes<a class="headerlink" href="#bulk-writes" title="Permanent link">&para;</a></h4>
<p>Legacy driver supports bulk writes of the same type, e.g. bulk inserts, bulk updates or bulk deletes.
For this tasks legacy driver has three classes - <code>\MongoInsertBatch</code>, <code>\MongoUpdateBatch</code>
and <code>\MongoDeleteBatch</code>. To add operation to a batch, you must use a weird syntax:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="sd">/** @var \MongoCollection $collection */</span>
<span class="nv">$batch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\MongoUpdateBatch</span><span class="p">(</span><span class="nv">$collection</span><span class="p">);</span>

<span class="nv">$batch</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">([</span>
    <span class="s1">&#39;q&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span> <span class="c1">// query (filter) document</span>
    <span class="s1">&#39;u&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;set&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;updated_at&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">\MongoDate</span><span class="p">()]]</span> <span class="c1">// update document</span>
<span class="p">]);</span>

<span class="nv">$batch</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>


<p>The new low-level MongoDB driver allows to mix different types of writes in one bulk.
This means that you could add different write operations to one bulk, and even chain
this operations, for example insert a document and than update many documents, including
inserted one.
The MongoDB Driver Specifications has a definition of "write models".
Write model - is an object that specifies the type of write operation and it's arguments.
Tequila MongoDB PHP Lib implements all write models from driver specifications.
There are 6 write model classes: <code>InsertOne</code>, <code>UpdateOne</code>, <code>UpdateMany</code>, <code>ReplaceOne</code>,
<code>DeleteOne</code> and <code>DeleteMany</code>. All this classes reside in namespace <code>Tequila\MongoDB\Write\Model</code>.</p>
<p>Here is an example of bulk writes functionality usage in this driver:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Tequila\MongoDB\Write\Model\InsertOne</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Tequila\MongoDB\Write\Model\UpdateMany</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Tequila\MongoDB\Write\Model\UpdateOne</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Tequila\MongoDB\Write\Model\DeleteMany</span><span class="p">;</span>

<span class="sd">/** @var \Tequila\MongoDB\Collection $collection */</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">bulkWrite</span><span class="p">([</span>
    <span class="k">new</span> <span class="nx">InsertOne</span><span class="p">([</span><span class="s1">&#39;firstName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Trevor&#39;</span><span class="p">,</span> <span class="s1">&#39;lastName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Philips&#39;</span><span class="p">]),</span>
    <span class="k">new</span> <span class="nx">InsertOne</span><span class="p">([</span><span class="s1">&#39;firstName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Michael&#39;</span><span class="p">,</span> <span class="s1">&#39;lastName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;De Santa&#39;</span><span class="p">]),</span>
    <span class="k">new</span> <span class="nx">InsertOne</span><span class="p">([</span><span class="s1">&#39;firstName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Franklin&#39;</span><span class="p">,</span> <span class="s1">&#39;lastName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Clinton&#39;</span><span class="p">]),</span>
    <span class="k">new</span> <span class="nx">InsertOne</span><span class="p">([</span><span class="s1">&#39;firstName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Bradley&#39;</span><span class="p">,</span> <span class="s1">&#39;lastName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Snider&#39;</span><span class="p">]),</span>
    <span class="k">new</span> <span class="nx">UpdateMany</span><span class="p">([],</span> <span class="p">[</span><span class="s1">&#39;$set&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;sex&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;male&#39;</span><span class="p">]]),</span>
    <span class="k">new</span> <span class="nx">UpdateOne</span><span class="p">([</span><span class="s1">&#39;firstName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Bradley&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;$set&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;alive&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">]]),</span>
    <span class="k">new</span> <span class="nx">DeleteMany</span><span class="p">([</span><span class="s1">&#39;alive&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">]),</span>
<span class="p">]);</span>

<span class="nv">$cursor</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>

<span class="k">echo</span> <span class="nv">$cursor</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()[</span><span class="s1">&#39;firstName&#39;</span><span class="p">];</span> <span class="c1">// outputs &quot;Trevor&quot;</span>
<span class="k">echo</span> <span class="nv">$cursor</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()[</span><span class="s1">&#39;sex&#39;</span><span class="p">];</span> <span class="c1">// outputs &quot;male&quot;</span>

<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">findOne</span><span class="p">([</span><span class="s1">&#39;firstName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Bradley&#39;</span><span class="p">]);</span> <span class="c1">// returns null</span>
</pre></div>


<h4 id="write-results">Write results<a class="headerlink" href="#write-results" title="Permanent link">&para;</a></h4>
<p>The only way to insert, delete or update documents in collection is to use
the bulk write API, provided by the low-level driver.
At high-level, bulk writes are done using <code>Tequila\MongoDB\Collection::bulkWrite()</code>
method and write models (see example above).
This method returns an instance of <code>Tequila\MongoDB\WriteResult</code> class.
This class wraps the <code>MongoDB\Driver\WriteResult</code> class and adds functionality of inserted ids.
Other write methods, such as <code>Collection::insertOne()</code> or <code>Collection::updateMany()</code>
internally use <code>Collection::bulkWrite()</code> method and wrap <code>Tequila\MongoDB\WriteResult</code>
to provide their results, such as <code>Tequila\MongoDB\Write\Result\InsertOneResult</code>
or <code>Tequila\MongoDB\Write\Result\UpdateResult</code>.</p>
<h4 id="id-of-inserted-document">Id of inserted document<a class="headerlink" href="#id-of-inserted-document" title="Permanent link">&para;</a></h4>
<p>The legacy driver takes care of setting the id of inserted document to this document.
New driver does not do this, and it's up to user to decide, what to do with id of an inserted document:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="sd">/** @var \Tequila\MongoDB\Collection $collection */</span>
<span class="nv">$document</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\stdClass</span><span class="p">();</span>
<span class="nv">$document</span><span class="o">-&gt;</span><span class="na">firstName</span> <span class="o">=</span> <span class="s1">&#39;Trevor&#39;</span><span class="p">;</span>
<span class="nv">$document</span><span class="o">-&gt;</span><span class="na">lastName</span> <span class="o">=</span> <span class="s1">&#39;Philips&#39;</span><span class="p">;</span>

<span class="sd">/** @var \Tequila\MongoDB\Write\Result\InsertOneResult $result */</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">insertOne</span><span class="p">(</span><span class="nv">$document</span><span class="p">);</span>
<span class="nv">$document</span><span class="o">-&gt;</span><span class="na">_id</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">getInsertedId</span><span class="p">();</span>

<span class="c1">// or, for a bulk inserts:</span>
<span class="nv">$documents</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;firstName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Trevor&#39;</span><span class="p">,</span> <span class="s1">&#39;lastName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Philips&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;firstName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Michael&#39;</span><span class="p">,</span> <span class="s1">&#39;lastName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;De Santa&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;firstName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Franklin&#39;</span><span class="p">,</span> <span class="s1">&#39;lastName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Clinton&#39;</span><span class="p">],</span>
<span class="p">];</span>

<span class="sd">/** @var \Tequila\MongoDB\Write\Result\InsertManyResult $result */</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">insertMany</span><span class="p">(</span><span class="nv">$documents</span><span class="p">);</span>

<span class="c1">// InsertManyResult::getInsertedIds() and WriteResult::getInsertedIds() returns</span>
<span class="c1">// an array of inserted ids, where the key is the position of the inserted document</span>
<span class="c1">// and value is an id.</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="na">getInsertedIds</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$position</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$documents</span><span class="p">[</span><span class="nv">$position</span><span class="p">][</span><span class="s1">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$id</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-7018102a8b.js"></script>
      <script>app.initialize({url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>